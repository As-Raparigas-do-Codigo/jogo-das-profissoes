name: Publish

on:
  push:
    branches: [ deploy ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Updates packages
        run: sudo apt-get update
      - name: Install cadaver
        run: sudo dpkg --configure -a && DEBIAN_FRONTEND=noninteractive sudo apt-get -yq install cadaver
      - name: Write creds to .netrc
        run: echo 'default' > ~/.netrc && echo 'login ${{ secrets.JDP_USER }}' >> ~/.netrc && echo 'password ${{ secrets.JDP_PWD }}' >> ~/.netrc
      - name: Change permission to .netrc
        run: chmod 600 ~/.netrc
      - name: Write cadaver settings
        run: echo 'open https://jogodasprofissoes.pt:2078' > ~/.cadaverrc
      - name: Change permission to .cadaverrc
        run: chmod 600 ~/.cadaverrc
      - name: Start cadaver
        run: cadaver
      - name: List files
        run: ls