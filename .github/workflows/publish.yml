name: Publish

on:
  push:
    branches: [ deploy ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Atualiza pacotes
        run: sudo apt-get update
      - name: Instala o pacote 'cadaver'
        run: sudo dpkg --configure -a && DEBIAN_FRONTEND=noninteractive sudo apt-get -yq install cadaver
      - name: Instala o pacote 'git'
        run: sudo apt-get -yq install git
      - name: Clona o project
        run: git clone https://github.com/As-Raparigas-do-Codigo/jogo-das-profissoes.git
      - name: Escreve as credenciais do WebDav no ficheiro .netrc
        run: echo 'default' > ~/.netrc && echo 'login ${{ secrets.JDP_USER }}' >> ~/.netrc && echo 'password ${{ secrets.JDP_PWD }}' >> ~/.netrc
      - name: Altera as permissões do ficheiro .netrc
        run: chmod 600 ~/.netrc
      - name: Escreve os settings do cadaver
        run: echo 'open https://jogodasprofissoes.pt:2078' > ~/.cadaverrc
      - name: Altera as permissões do ficheiro .cadaverrc
        run: chmod 600 ~/.cadaverrc
      - name: Arranca o cadaver
        run: cadaver
      - name: Lista os ficheiros
        run: ls